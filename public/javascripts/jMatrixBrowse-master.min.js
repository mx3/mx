(function(c){function a(a){if("string"===typeof a.data){var d=a.handler,e=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var j="keypress"!==a.type&&c.hotkeys.specialKeys[a.which],i=String.fromCharCode(a.which).toLowerCase(),g="",n={};a.altKey&&"alt"!==j&&(g+="alt+");a.ctrlKey&&"ctrl"!==j&&(g+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==j)&&(g+="meta+");a.shiftKey&&"shift"!==j&&(g+="shift+");j?n[g+j]=
!0:(n[g+i]=!0,n[g+c.hotkeys.shiftNums[i]]=!0,"shift+"===g&&(n[c.hotkeys.shiftNums[i]]=!0));j=0;for(i=e.length;j<i;j++)if(n[e[j]])return d.apply(this,arguments)}}}}c.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",
109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};c.each(["keydown","keyup","keypress"],function(){c.event.special[this]={add:a}})})(jQuery);(function(c){function a(a){var h=a||window.event,j=[].slice.call(arguments,1),i=0,g=0,n=0,a=c.event.fix(h);a.type="mousewheel";h.wheelDelta&&(i=h.wheelDelta/120);h.detail&&(i=-h.detail/3);n=i;void 0!==h.axis&&h.axis===h.HORIZONTAL_AXIS&&(n=0,g=-1*i);void 0!==h.wheelDeltaY&&(n=h.wheelDeltaY/120);void 0!==h.wheelDeltaX&&(g=-1*h.wheelDeltaX/120);j.unshift(a,i,g,n);return(c.event.dispatch||c.event.handle).apply(this,j)}var i=["DOMMouseScroll","mousewheel"];if(c.event.fixHooks)for(var d=i.length;d;)c.event.fixHooks[i[--d]]=
c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var c=i.length;c;)this.addEventListener(i[--c],a,!1);else this.onmousewheel=a},teardown:function(){if(this.removeEventListener)for(var c=i.length;c;)this.removeEventListener(i[--c],a,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(c){return c?this.bind("mousewheel",c):this.trigger("mousewheel")},unmousewheel:function(c){return this.unbind("mousewheel",c)}})})(jQuery);var jMatrixBrowseNs=jMatrixBrowseNs||{};
jMatrixBrowseNs.Constants={OVERFLOW_LEFT:1,OVERFLOW_RIGHT:2,OVERFLOW_TOP:3,OVERFLOW_BOTTOM:4,OVERFLOW_NONE:-1,CLASS_BASE:"jmatrixbrowse",N_BACKGROUND_CELLS:1,DEFAULT_OPTIONS:{str_initialWindowPosition:"0,0",str_initialWindowSize:"10,10",boo_snap:!1,boo_animate:!1,minVelocityForAnimation:4,animationDuration:2E3,str_api:"test"},DEFAULT_DATA_RELOAD_STRATEGY:1,RELOAD_HTML_REPLACEMENT:1,RELOAD_CELL_REPLACEMENT:2,RELOAD_CELL_POSITION:3,BACKGROUND_DATA_RELOAD_DELAY:2E3,ZOOM_LEVEL_DIFFERENCE:2,ZOOM_MAX_WINDOW_SIZE:{height:10,
width:20}};jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.Configuration=function(i){var d=a.Constants.DEFAULT_DATA_RELOAD_STRATEGY;var e={boo_jMatrixBrowser:"true"===i.attr("data-jmatrix_browser"),str_api:i.attr("data-api"),str_initialWindowSize:i.attr("data-initial-window-size"),str_initialWindowPosition:i.attr("data-initial-window-position"),boo_snap:"true"===i.attr("data-snap"),boo_animate:"true"===i.attr("data-animate"),animationDuration:i.attr("data-deceleration-duration"),minVelocityForAnimation:i.attr("data-min-velocity-for-animation")};i.attr("data-animate");
if(!0!==e.boo_jMatrixBrowser&&!0!==e.boo_jMatrixBrowser)throw"data-jmatrix_browser invalid";if(e.str_initialWindowSize&&!/\s*\d+\s*,\s*\d+\s*/.test(e.str_initialWindowSize))throw"data-initial-window-size invalid.";if(e.str_initialWindowPosition&&!/\s*\d+\s*,\s*\d+\s*/.test(e.str_initialWindowPosition))throw"data-initial-window-size invalid.";var h=c.extend(a.Constants.DEFAULT_OPTIONS,e);this.getSettings=function(){return h};this.getWindowSize=function(){if(h&&h.str_initialWindowSize){var c=a.Utils.parsePosition(h.str_initialWindowSize);
return{height:c.row,width:c.col}}return null};this.setWindowSize=function(c){h.str_initialWindowSize=c.height+","+c.width};this.getWindowPosition=function(){return h&&h.str_initialWindowPosition?a.Utils.parsePosition(h.str_initialWindowPosition):null};this.getApiUrl=function(){return h.str_api};this.getNumberOfBackgroundCells=function(){return a.Constants.N_BACKGROUND_CELLS};this.getDataReloadStrategy=function(){return d};this.isSnapEnabled=function(){return h.boo_snap};this.getAnimationDuration=
function(){return h.animationDuration};this.getMinVelocityForAnimation=function(){return h.minVelocityForAnimation};this.animateEnabled=function(){return h.boo_animate};return this}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.jMatrixBrowseRenderer=function(i,d,e){var h,j;function r(s){x.setRenderer(k);var b=u,w=c(document.createElement("div"));w.css({width:"90%",height:"10%",top:"0px",right:"0px","background-color":"red",position:"absolute",overflow:"hidden"});w.addClass(a.Constants.CLASS_BASE+"-col-header");b.append(w);var g=c(document.createElement("div"));g.css({width:"10%",height:"90%",bottom:"0px","background-color":"green","float":"left",position:"absolute",overflow:"hidden"});g.addClass(a.Constants.CLASS_BASE+
"-row-header");b.append(g);z={row:g,col:w};b=u;w=c(document.createElement("div"));w.css({"float":"left",width:"90%",height:"90%",bottom:"0px",right:"0px",position:"absolute",overflow:"hidden"});w.addClass(a.Constants.CLASS_BASE+"-drag-container-container");b.append(w);var i=c(document.createElement("div"));i.draggable({drag:function(c,b){c.type="jMatrixBrowseDrag";u.trigger(c);y.push({position:b.position,timestamp:(new Date).getTime()});60<y.length&&y.splice(0,30)},start:function(c){D?(C.stop(),E=
!0,D=!1):E=!1;c.type="jMatrixBrowseDragStart";u.trigger(c)},stop:function(b){var f=(new Date).getTime();if(q.animateEnabled()){var s=y.length-1;if(1E3>f-y[s].timestamp){for(var a=f=s;0<a&&y[a].timestamp>y[s].timestamp-100;--a)f=a;if(f!==s&&(a=y[s].timestamp-y[f].timestamp,h=(y[s].position.left-y[f].position.left)/a,j=(y[s].position.top-y[f].position.top)/a,h=Math.abs(h)<q.getMinVelocityForAnimation()?0:h,j=Math.abs(j)<q.getMinVelocityForAnimation()?0:j,0<Math.abs(h)||0<Math.abs(j)))s=q.getAnimationDuration(),
E&&(j*=2,h*=2),C.animate({top:"+="+j*s,left:"+="+h*s},{duration:s,easing:!E?"easeOutCubic":"easeInOutCubic",step:function(c,f){u.trigger({type:"jMatrixBrowseAnimationStep",now:c,fx:f})},complete:function(){D=false;var f=n(c(this).position(),{top:0,left:0},C.draggable().data("draggable"));C.animate(f,{duration:"fast",complete:function(){u.trigger({type:"jMatrixBrowseAnimationComplete"})}})}}),D=!0}}b.type="jMatrixBrowseDragStop";u.trigger(b)},containment:[0,0,2E3,2E3]});i.draggable().data("draggable")._generatePosition=
function(f){var b=i.draggable().data("draggable"),s="absolute"==b.cssPosition&&!(b.scrollParent[0]!=document&&$.ui.contains(b.scrollParent[0],b.offsetParent[0]))?b.offsetParent:b.scrollParent,a=/(html|body)/i.test(s[0].tagName),k=f.pageX,f={top:f.pageY-b.offset.click.top-b.offset.relative.top-b.offset.parent.top+(c.browser.safari&&526>c.browser.version&&"fixed"==b.cssPosition?0:"fixed"==b.cssPosition?-b.scrollParent.scrollTop():a?0:s.scrollTop()),left:k-b.offset.click.left-b.offset.relative.left-
b.offset.parent.left+(c.browser.safari&&526>c.browser.version&&"fixed"==b.cssPosition?0:"fixed"==b.cssPosition?-b.scrollParent.scrollLeft():a?0:s.scrollLeft())},s={top:b._convertPositionTo("absolute",f).top-b.positionAbs.top,left:b._convertPositionTo("absolute",f).left-b.positionAbs.left};return n(f,s,b)};i.addClass(a.Constants.CLASS_BASE+"-drag-container");w.append(i);C=i;A=w;b=s.row;s=s.col;_cellPosition=c("."+("j-matrix-browse-cell-row"+b+"col"+s)).position();t.currentCell={row:b,col:s};b=C;if(void 0==
x.getMatrixSize())console.error("Unable to get matrix size"),_content=null;else{var e=q.getWindowSize();if(void 0==e)console.error("Unable to get window size"),_content=null;else{s=c(document.createElement("div")).addClass("jMatrixBrowse-content");b.append(s);s.css({position:"absolute",top:0,left:0});var b=A.height()/e.height,w=A.width()/e.width,d=q.getWindowPosition();f=[];for(var g=e.height+2*q.getNumberOfBackgroundCells(),e=e.width+2*q.getNumberOfBackgroundCells(),l=Math.max(0,d.row-q.getNumberOfBackgroundCells()),
d=Math.max(0,d.col-q.getNumberOfBackgroundCells()),p=document.createDocumentFragment(),r=l;r<l+g;r++){f.push([]);for(var o=d;o<d+e;o++){var m=document.createElement("div");m.style.backgroundColor=0<r%2+o%2?"#ddd":"whitesmoke";m.style.width=w+"px";m.style.height=b+"px";m.style.position="absolute";m.style.top=(r-l-q.getNumberOfBackgroundCells())*b+"px";m.style.left=(o-d-q.getNumberOfBackgroundCells())*w+"px";m.style.display="inline-block";m.style.textIndent="6px";m.innerHTML=r+","+o;m.className+=" jMatrixBrowse-cell "+
("j-matrix-browse-cell-row"+r+"col"+o);c(m).attr("data-row",r);c(m).attr("data-col",o);p.appendChild(m);f[r-l].push(m)}}s.append(p);u.find(".jMatrixBrowse-cell").click(function(b){if(F)F=!1;else{var f=c(this);b.type="jMatrixBrowseClick";b.row=f.attr("data-row");b.col=f.attr("data-col");u.trigger(b)}});_content=s}}s=z;b=s.row;w=x.getRowHeadersFromTopRow(t.currentCell.row-q.getNumberOfBackgroundCells());g=document.createDocumentFragment();e=0;for(l=w.length;e<l;++e)p=c(f[e][0]),d=c(document.createElement("div")),
d.addClass(a.Constants.CLASS_BASE+"-row-header-cell"),p={width:"100%",height:p.height(),top:p.position().top,left:0,position:"absolute"},d.css(p),d.html(w[e]),g.appendChild(d[0]);b.append(g);s=s.col;b=x.getColHeadersFromLeftCol(t.currentCell.col-q.getNumberOfBackgroundCells());w=document.createDocumentFragment();g=0;for(e=b.length;g<e;++g)d=c(f[0][g]),l=c(document.createElement("div")),l.addClass(a.Constants.CLASS_BASE+"-col-header-cell"),d={width:d.width(),height:"100%",left:d.position().left,top:0,
position:"absolute"},l.css(d),l.html(b[g]),w.appendChild(l[0]);s.append(w);u.trigger("jMatrixBrowseRendererInitialized")}function g(){z.row.remove();z.col.remove();C.remove();A.remove()}function n(b,a){var k=c(f[0==t.currentCell.row?1:0][0==t.currentCell.col?1:0]),g=A.offset(),d=k.offset();1>=t.currentCell.row&&(k=a.top+d.top-g.top,0<k&&(b.top-=k));1>=t.currentCell.col&&(d=a.left+d.left-g.left,0<d&&(b.left-=d));k=c(f[f.length-1][f[0].length-1]);d=k.offset();if(t.currentCell.row-q.getNumberOfBackgroundCells()+
f.length-1>=x.getMatrixSize().height-1){var e=g.top+A.height(),h=a.top+d.top+k.height(),e=e-h;0<e&&(b.top+=e)}t.currentCell.col-q.getNumberOfBackgroundCells()+f[0].length-1>=x.getMatrixSize().width-1&&(g=g.left+A.width(),d=a.left+d.left+k.width(),g-=d,0<g&&(b.left+=g));return b}function p(b){var c=x.getMatrixSize();return"up"===b&&1>t.currentCell.row||"down"===b&&t.currentCell.row-q.getNumberOfBackgroundCells()+f.length-1>c.height-1||"right"===b&&t.currentCell.col-q.getNumberOfBackgroundCells()+f[0].length-
1>c.width-1||"left"===b&&1>t.currentCell.col?!1:!0}function o(){for(var b=2*q.getNumberOfBackgroundCells()+1,k=2*q.getNumberOfBackgroundCells()+1,g=[],d=[],e=A.offset(),h=0;h<b&&h<f.length;++h)for(var i=0;i<k&&i<f[h].length;++i){var j=c(f[h][i]).offset();d.push((j.top-e.top)*(j.top-e.top)+(j.left-e.left)*(j.left-e.left));g.push(c(f[h][i]))}return g[a.Utils.findIndexOfMin(d).minIndex]}function b(b){var c=q.getWindowSize().height;if("up"===b){if(b=t.currentCell.row-c,1>b)return Math.max(0,c+b)}else{var b=
x.getMatrixSize().height,a=t.currentCell.row+c+f.length-q.getNumberOfBackgroundCells()-1;if(a>=b-1)return Math.max(0,c-(a-b))}return c}function l(b){var c=q.getWindowSize().width;if("left"===b){if(b=t.currentCell.col-c,0>b)return Math.max(0,c+b)}else{var b=x.getMatrixSize().width,a=t.currentCell.col+c+f[0].length-q.getNumberOfBackgroundCells()-1;if(a>=b)return Math.max(0,c-(a-b))}return c}function m(b,a){if(0!==a){var g=c.extend({},t.currentCell);if("up"===b)for(var d=0;d<a;++d){var e=f.length-1;
k.moveRowToTop(e);--t.currentCell.row}else for(d=0;d<a;++d)e=0,k.moveRowToEnd(e),++t.currentCell.row;d=0;for(e=f.length;d<e;++d)for(var h=0,i=f[d].length;h<i;++h){var j=c(f[d][h]);j.css({top:j.position().top+("up"===b?a:-a)*j.height()})}d=t.currentCell;z.row.children().each(function(b,a){var k=A.offset(),k=c(f[b][0]).offset().top-k.top;c(a).css({top:k})});u.trigger({type:"jMatrixBrowseChange",previousCell:g,currentCell:d,direction:"down"===b?"top":"bottom"})}}function B(b,a){if(0!==a){var g=c.extend({},
t.currentCell);if("left"===b)for(var d=0;d<a;++d){var e=f[0].length-1;k.moveColToLeft(e);--t.currentCell.col}else for(d=0;d<a;++d)e=0,k.moveColToRight(e),++t.currentCell.col;d=0;for(e=f.length;d<e;++d)for(var h=0,j=f[d].length;h<j;++h){var i=c(f[d][h]);i.css({left:i.position().left+("left"===b?a:-a)*i.width()})}d=t.currentCell;z.col.children().each(function(b,a){var k=A.offset(),k=c(f[0][b]).offset().left-k.left;c(a).css({left:k})});u.trigger({type:"jMatrixBrowseChange",previousCell:g,currentCell:d,
direction:"left"===b?"right":"left"})}}function v(b,a){for(var k=b.row1;k<=b.row2;++k)for(var d=a.col1;d<=a.col2;++d)c(f[k][d]).html('<div class="jMatrixBrowse-loading"/>')}var k=this,C,f,z,u,q,x,t,F=!1,A,y=[],D=!1,E=!1;t=k;u=i;q=d;x=e;i.addClass("jmb-matrix-container");this.getCellElements=function(){return f};this.getHeaders=function(){return z};this.getContainer=function(){return A};this.moveRowToEnd=function(b){var a=f.length,a=0<f[a-1].length?c(f[a-1][0]):void 0;if(void 0===a)return console.error("Unable to move row "+
b+" to the end."),!1;for(var a=a.position().top+a.height(),k=0,d=f[b].length;k<d;++k)c(f[b][k]).css({top:a});b=f.splice(b,1);0<b.length&&f.push(b[0]);v({row1:f.length-1,row2:f.length-1},{col1:0,col2:f[0].length-1});return!0};this.moveRowToTop=function(b){var a=0<f.length&&0<f[0].length?c(f[0][0]):void 0;if(void 0===a)return console.error("Unable to move row "+b+" to top."),!1;for(var a=a.position().top,k=0,d=f[b].length;k<d;++k)c(f[b][k]).css({top:a-c(f[b][k]).height()});b=f.splice(b,1);0<b.length&&
f.splice(0,0,b[0]);v({row1:0,row2:0},{col1:0,col2:f[0].length-1});return!0};this.moveColToRight=function(b){if(0>=f.length||0>=f[0].length)return console.error("Unable to move col "+b+" to right."),!1;for(var a=c(f[0][f[0].length-1]),k=a.position().left+a.width(),a=0,d=f.length;a<d;++a)c(f[a][b]).css({left:k});a=0;for(d=f.length;a<d;++a)k=f[a].splice(b,1),f[a].push(k[0]);v({row1:0,row2:f.length-1},{col1:f[0].length-1,col2:f[0].length-1});return!0};this.moveColToLeft=function(b){if(0>=f.length||0>=
f[0].length)return console.error("Unable to move col "+b+" to left."),!1;for(var a=c(f[0][0]).position().left,k=0,d=f.length;k<d;++k)c(f[k][b]).css({left:a-c(f[k][b]).width()});k=0;for(d=f.length;k<d;++k)a=f[k].splice(b,1),f[k].splice(0,0,a[0]);v({row1:0,row2:f.length-1},{col1:0,col2:0});return!0};this.scrollRight=function(){p("right")&&B("right",1)};this.scrollLeft=function(){p("left")&&B("left",1)};this.scrollUp=function(){p("up")&&m("up",1)};this.scrollDown=function(){p("down")&&m("down",1)};this.pageUp=
function(){var a=b("up");m("up",a)};this.pageDown=function(){var a=b("down");m("down",a)};this.pageLeft=function(){var b=l("left");B("left",b)};this.pageRight=function(){var b=l("right");B("right",b)};this.snapToGrid=function(b,a){if(void 0===b&&void 0===a)t.snapToGrid(o());else{var c=A.offset(),k=b.offset(),f=C.offset();if("top"===a||void 0===a){var d=k.top-c.top;0!==d&&(f.top-=d)}if("left"===a||void 0===a)c=k.left-c.left,0!==c&&(f.left-=c);C.offset(f)}};this.zoomIn=function(){var b=q.getWindowSize();
q.setWindowSize({height:Math.max(1,b.height-a.Constants.ZOOM_LEVEL_DIFFERENCE),width:Math.max(1,b.width-a.Constants.ZOOM_LEVEL_DIFFERENCE)});g();r(t.currentCell)};this.zoomOut=function(){var b=q.getWindowSize(),b={height:Math.min(a.Constants.ZOOM_MAX_WINDOW_SIZE.height,x.getMatrixSize().height,b.height+a.Constants.ZOOM_LEVEL_DIFFERENCE),width:Math.min(a.Constants.ZOOM_MAX_WINDOW_SIZE.width,x.getMatrixSize().width,b.width+a.Constants.ZOOM_LEVEL_DIFFERENCE)};q.setWindowSize(b);var c=x.getMatrixSize(),
k=t.currentCell,k={row:k.row+b.height>c.height?c.height-b.height:k.row,col:k.col+b.width>c.width?c.width-b.width:k.col};g();r(k)};this.getIsAnimating=function(){return D};r(q.getWindowPosition());return k}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.BackgroundDataManager=function(i,d,e){var h,j={row1:0,col1:0,row2:0,col2:0};h=c("<div/>",{className:"jMatrixBrowse-background-data-container"}).appendTo(i);(function g(n){setTimeout(function(){d.getResponseDataAsync(n,function(p){for(var o=0;o<p.length;++o)for(var b=0;b<p[o].length;++b){var l=c("<div/>",{className:"jMatrixBrowse-background-cell","data-row":o+n.row1,"data-col":b+n.col1,html:p[o][b]});e.getDataReloadStrategy===a.Constants.RELOAD_CELL_POSITION?(i.find(".jMatrixBrowse-content").append(l),
l.hide()):h.append(l)}j.row2=n.row2;j.col2=n.col2;p=d.getMatrixSize();if(n.row2<p.height-1)n.row1=Math.min(n.row1+20+1,p.height-1),n.row2=Math.min(n.row2+20+1,p.height-1);else if(n.row1=0,n.row2=20,n.col2<p.width-1)n.col1=Math.min(n.col1+20+1,p.width-1),n.col2=Math.min(n.col2+20+1,p.width-1);else{i.trigger({type:"jMatrixBrowseLoadComplete"});return}g(n)})},a.Constants.BACKGROUND_DATA_RELOAD_DELAY)})({row1:0,row2:20,col1:0,col2:20});this.getCellsForRequest=function(g,h){for(var j=[],o=!1,b=g.col1;b<=
g.col2;++b){for(var l=g.row1;l<=g.row2;++l)if(0==i.find(".jMatrixBrowse-background-cell[data-row="+l+"][data-col="+b+"]").length){j.push({row1:l,col1:b,row2:g.row2,col2:g.col2});o=!0;break}if(o)break}o&&l>g.row1&&(l<g.row2&&b>g.col1&&b<g.col2)&&j.push({row1:g.row1,col1:b+1,row2:l-1,col2:g.col2});if(0<j.length)for(var m=j.length,B=Array(m),o=j.length-1;0<=o;o--)(function(b){d.getResponseDataAsync(j[b],function(k){B[b]=k;--m;if(0==m){for(var k=Array(g.row2-g.row1+1),d=k.length-1;0<=d;d--)k[d]=Array(g.col2-
g.col1+1);for(d=B.length-1;0<=d;--d)for(var f=B[d],z=j[d],u=f.length-1;0<=u;--u)for(var q=f[u].length-1;0<=q;--q){var l=c("<div/>",{className:"jMatrixBrowse-background-cell","data-row":u+z.row1,"data-col":q+z.col1,html:f[u][q]});e.getDataReloadStrategy===a.Constants.RELOAD_CELL_POSITION&&(i.find(".jMatrixBrowse-content").append(l),l.hide());k[u+z.row1-g.row1][q+z.col1-g.col1]=l}for(u=g.col1;u<=j[0].col1;++u)for(d=g.row1;d<=g.row2&&!(u==j[0].col1&&d>=j[0].row1);++d)k[d-g.row1][u-g.col1]=i.find(".jMatrixBrowse-background-cell[data-row="+
d+"][data-col="+u+"]");h.call(this,k)}})})(o);else{b=[];for(o=g.row1;o<=g.row2;++o){b.push([]);for(l=g.col1;l<=g.col2;++l)b[o-g.row1].push(i.find(".jMatrixBrowse-background-cell[data-row="+o+"][data-col="+l+"]"))}h.call(this,b)}};this.getWindowLoaded=function(){return j};return this}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){c.fn.jMatrixBrowse=function(){function i(c){switch(c){case a.Constants.OVERFLOW_TOP:++b.currentCell.row;break;case a.Constants.OVERFLOW_BOTTOM:--b.currentCell.row;break;case a.Constants.OVERFLOW_LEFT:++b.currentCell.col;break;case a.Constants.OVERFLOW_RIGHT:--b.currentCell.col}}function d(c){switch(c){case a.Constants.OVERFLOW_TOP:return b.currentCell.row-l.getNumberOfBackgroundCells()+b.getCellElements().length-1>=m.getMatrixSize().height-1?!1:!0;case a.Constants.OVERFLOW_BOTTOM:return b.currentCell.row<=
0+l.getNumberOfBackgroundCells()?!1:!0;case a.Constants.OVERFLOW_LEFT:return b.currentCell.col-l.getNumberOfBackgroundCells()+b.getCellElements()[0].length-1>=m.getMatrixSize().width-1?!1:!0;case a.Constants.OVERFLOW_RIGHT:return b.currentCell.col<=0+l.getNumberOfBackgroundCells()?!1:!0}}function e(){var c;c=j(b.getCellElements(),b.getContainer(),1,a.Constants.OVERFLOW_TOP)||!1;c=j(b.getCellElements(),b.getContainer(),b.getCellElements().length-2,a.Constants.OVERFLOW_BOTTOM)||c;c=r(b.getCellElements(),
b.getContainer(),1,a.Constants.OVERFLOW_LEFT)||c;if(c=r(b.getCellElements(),b.getContainer(),b.getCellElements()[0].length-2,a.Constants.OVERFLOW_RIGHT)||c)e(),h()}function h(){b.getHeaders().row.children().each(function(a,d){var f=b.getContainer().offset(),f=c(b.getCellElements()[a][0]).offset().top-f.top;c(d).css({top:f})});b.getHeaders().col.children().each(function(a,d){var f=b.getContainer().offset(),f=c(b.getCellElements()[0][a]).offset().left-f.left;c(d).css({left:f})})}function j(k,g,f,e){if(0<
k[f].length&&a.Utils.isOverflowing(c(k[f][0]),g,e)&&d(e)){g=c.extend({},b.currentCell);i(e);var j;switch(e){case a.Constants.OVERFLOW_TOP:j="top";if(!1===b.moveRowToEnd(0))return!1;break;case a.Constants.OVERFLOW_BOTTOM:if(j="bottom",!1===b.moveRowToTop(k.length-1))return!1}v.trigger({type:"jMatrixBrowseChange",previousCell:g,currentCell:b.currentCell,direction:j});return!0}return!1}function r(k,g,f,e){if(a.Utils.isOverflowing(c(k[0][f]),g,e)&&d(e)){g=c.extend({},b.currentCell);i(e);var j;switch(e){case a.Constants.OVERFLOW_LEFT:j=
"left";if(!1===b.moveColToRight(0))return!1;break;case a.Constants.OVERFLOW_RIGHT:if(j="right",!1===b.moveColToLeft(k[0].length-1))return!1}v.trigger({type:"jMatrixBrowseChange",previousCell:g,currentCell:b.currentCell,direction:j});return!0}return!1}function g(a,c){var d=0,e,j=Math.abs(a.currentCell.row-a.previousCell.row),h=a.currentCell.row-l.getNumberOfBackgroundCells(),i=a.currentCell.row-l.getNumberOfBackgroundCells()+b.getCellElements().length-1;if("top"===c){i>=m.getMatrixSize().height&&(d=
i-m.getMatrixSize().height+1);if(d===j)return-1;e={row1:i-(j-1),row2:i-d}}else if("bottom"===c){0>h&&(d=-h);if(d===j)return-1;e={row1:h+d,row2:h+(j-1)}}else"both"===c&&(e=g(a,"top"),j=g(a,"bottom"),-1===e&&(e={row2:i}),-1===j&&(j={row1:h}),e={row1:j.row1,row2:e.row2});e.rowsNotInBound=d;return e}function n(a,c){var d=0,g,e=Math.abs(a.currentCell.col-a.previousCell.col),j=a.currentCell.col-l.getNumberOfBackgroundCells(),h=a.currentCell.col-l.getNumberOfBackgroundCells()+b.getCellElements()[0].length-
1;if("left"===c){if(h>=m.getMatrixSize().width&&(d=h-m.getMatrixSize().width+1,d===e))return-1;g={col1:h-(e-1),col2:h}}else if("right"===c){if(0>j&&(d=-j,d===e))return-1;g={col1:j+d,col2:j+(e-1)}}else"both"===c&&(g=n(a,"left"),e=n(a,"right"),-1===g&&(g={col2:h}),-1===e&&(e={col1:j}),g={col1:e.col1,col2:g.col2});g.colsNotInBound=d;return g}function p(d,g,f){for(var e=d.row1;e<=d.row2;++e){var j=e-b.currentCell.row+l.getNumberOfBackgroundCells();if(!(0>j||j>=b.getCellElements().length))for(var h=b.getCellElements()[j],
i=g.col1;i<=g.col2;++i){var n=i-b.currentCell.col+l.getNumberOfBackgroundCells();if(!(0>n||n>=h.length)){var r=c(h[n]),o=j,p=n,m=f[e-d.row1][i-g.col1],n=e,v=i;l.getDataReloadStrategy()===a.Constants.RELOAD_CELL_REPLACEMENT?(m=m.clone().removeClass("jMatrixBrowse-background-cell").addClass("jMatrixBrowse-cell").css({width:r.css("width"),height:r.css("height"),top:r.css("top"),left:r.css("left"),position:"absolute"}),r.replaceWith(m),b.getCellElements()[o][p]=m):l.getDataReloadStrategy()===a.Constants.RELOAD_HTML_REPLACEMENT?
(o=m.html(),r.html(o),r.attr("data-row",n),r.attr("data-col",v)):l.getDataReloadStrategy()===a.Constants.RELOAD_CELL_POSITION&&(m=m.removeClass("jMatrixBrowse-background-cell").addClass("jMatrixBrowse-cell").css({width:r.css("width"),height:r.css("height"),top:r.css("top"),left:r.css("left"),position:"absolute"}),r.hide(),m.show(),b.getCellElements()[o][p]=m)}}}}var o=this,b,l,m,B,v;this.reloadData=function(){var a=o.getCellWindow(b.currentCell);if(void 0==a)console.error("Unable to get cell window.");
else if((a=m.getResponse(a))&&a.data)for(var d=0;d<a.data.length;++d)for(var f=0;f<a.data[d].length;++f){var g=a.data[d][f];c(b.getCellElements()[d][f]).html(g)}};this.getPosition=function(){return b.currentCell};v=c("<div/>",{position:"absolute"}).appendTo(this);l=new a.Configuration(this);m="test"===l.getApiUrl()?new a.APIHandler("test"):new a.APIHandler("networked",l.getApiUrl());b=new a.jMatrixBrowseRenderer(v,l,m);v.bind("jMatrixBrowseRendererInitialized",function(){o.reloadData()});v.bind("jMatrixBrowseDrag",
function(){e();h()});v.bind("jMatrixBrowseAnimationStep",function(){e();h()});v.bind("jMatrixBrowseDragStop",function(){l.isSnapEnabled()&&!b.getIsAnimating()&&b.snapToGrid();e();h()});v.bind("jMatrixBrowseAnimationComplete",function(){l.isSnapEnabled()&&b.snapToGrid();e();h()});v.bind("jMatrixBrowseChange",function(a){a={currentCell:a.currentCell,previousCell:a.previousCell,direction:a.direction};if("top"===a.direction||"bottom"===a.direction){var d=m.getRowHeadersFromTopRow(a.currentCell.row-l.getNumberOfBackgroundCells());
b.getHeaders().row.children().each(function(b,a){b<d.length&&c(a).html(d[b])})}else{var f=m.getColHeadersFromLeftCol(a.currentCell.col-l.getNumberOfBackgroundCells());b.getHeaders().col.children().each(function(b,a){b<f.length&&c(a).html(f[b])})}if("top"===a.direction||"bottom"===a.direction){var e=g(a,a.direction);if(-1!==e){var j=n(a,"both");B.getCellsForRequest({row1:e.row1,row2:e.row2,col1:j.col1,col2:j.col2},function(b){p(e,j,b)})}}else{var h=n(a,a.direction);if(-1!==h){var i=g(a,"both");B.getCellsForRequest({row1:i.row1,
row2:i.row2,col1:h.col1,col2:h.col2},function(b){p(i,h,b)})}}});v.bind("jMatrixBrowseClick",function(b){console.log("click: "+b.row+", "+b.col)});c(document).bind("keydown","right",function(a){a.preventDefault();b.scrollRight()});c(document).bind("keydown","left",function(a){a.preventDefault();b.scrollLeft()});c(document).bind("keydown","up",function(a){a.preventDefault();b.scrollUp()});c(document).bind("keydown","down",function(a){a.preventDefault();b.scrollDown()});c(document).bind("keydown","j",
function(){b.scrollRight()});c(document).bind("keydown","h",function(){b.scrollLeft()});c(document).bind("keydown","k",function(){b.scrollUp()});c(document).bind("keydown","l",function(){b.scrollDown()});c(document).bind("keydown","ctrl+up",function(){b.pageUp()});c(document).bind("keydown","ctrl+down",function(){b.pageDown()});c(document).bind("keydown","ctrl+left",function(){b.pageLeft()});c(document).bind("keydown","ctrl+right",function(){b.pageRight()});c(document).bind("keydown","i",function(){console.log("zoom in");
b.zoomIn()});c(document).bind("keydown","o",function(){console.log("zoom out");b.zoomOut()});v.mousewheel(function(a){var c,d,e;a.ctrlKey?(c=b.pageLeft,d=b.pageRight,scrollDown=a.shiftKey?b.pageRight:b.pageDown,e=a.shiftKey?b.pageLeft:b.pageUp):(c=b.scrollLeft,d=b.scrollRight,scrollDown=a.shiftKey?b.scrollRight:b.scrollDown,e=a.shiftKey?b.scrollLeft:b.scrollUp);0<a.originalEvent.wheelDeltaX?c():0>a.originalEvent.wheelDeltaX&&d();0<a.originalEvent.wheelDeltaY?e():0>a.originalEvent.wheelDeltaY&&scrollDown()});
B=new a.BackgroundDataManager(v,m,l);return this}})(jQuery,jMatrixBrowseNs);function MatrixGenerator(c){function a(a){for(var c="",e=0;e<a;++e)c+=Math.random()>i?d[Math.floor(Math.random()*d.length)]:Math.floor(10*Math.random());return c}void 0==c&&(c="random");var i=0.5,d="ABCDEF".split(""),e,h,j;this.init=function(d,g){e=[];h=[];j=[];for(var i=0;i<d;++i){"random"==c?h.push(a(4*Math.random())):h.push("row "+i);e.push([]);for(var p=0;p<g;++p)"random"==c?(0==i&&j.push(a(4*Math.random())),e[i].push(a(4*Math.random()))):(0==i&&j.push("col "+p),e[i].push(i+", "+p))}};this.test_getMatrix=
function(){return e};this.test_getMatrixRowLabels=function(){return h};this.test_getMatrixColumnLabels=function(){return j}};function MockApi(c,a){var i=new MatrixGenerator("sequential");i.init(void 0==c?1E3:c,void 0==a?1E3:a);this.getResponse=function(a){for(var c=i.test_getMatrix(),h=i.test_getMatrixRowLabels(),j=i.test_getMatrixColumnLabels(),r=a.row1,g=a.row2,n=a.col1,a=a.col2,p={matrix:{height:c.length,width:c[0].length},row:{labels:[]},column:{labels:[]},data:[]},o=r;o<=g;++o){p.row.labels.push(h[o]);p.data.push([]);for(var b=n;b<=a;++b)o===r&&p.column.labels.push(j[b]),p.data[o-r].push(c[o][b])}return p};this.getResponseDataAsync=
function(a,c){var h=this.getResponse(a);c.call(this,h.data)};this.getResponseAsync=function(a,c){var h=this.getResponse(a);c.call(this,h)};this.getMatrixSize=function(){var a=this.getResponse({row1:0,col1:0,row2:0,col2:0});if(a)return a.matrix}};jMatrixBrowseNs=jMatrixBrowseNs||{};
jMatrixBrowseNs.Utils={parsePosition:function(c){c=c.split(",");if(2==c.length)return{row:parseInt(c[0]),col:parseInt(c[1])}},isOverflowing:function(c,a,i){var d=a.offset(),e=c.offset(),h=e.top-d.top,d=e.left-d.left,e=c.width(),c=c.height();switch(i){case jMatrixBrowseNs.Constants.OVERFLOW_LEFT:return 0>d+e;case jMatrixBrowseNs.Constants.OVERFLOW_RIGHT:return d>a.width();case jMatrixBrowseNs.Constants.OVERFLOW_TOP:return 0>h+c;case jMatrixBrowseNs.Constants.OVERFLOW_BOTTOM:return h>a.height()}return!1},
findIndexOfMin:function(c){if(c&&c.length){for(var a=c[0],i=0,d=1,e=c.length;d<e;++d)c[d]<a&&(a=c[d],i=d);return{min:a,minIndex:i}}return null}};jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.NetworkedAPI=function(a){c.get(a,{row1:0,col1:0,row2:0,col2:0},function(a){this.matrixSize=a.matrix});this.getResponseAsync=function(d,e){c.get(a,d,function(a){e.call(this,a)})};this.getResponseDataAsync=function(d,e){c.get(a,d,function(a){e.call(this,a.data)})};this.getMatrixSize=function(){return this.matrixSize}};a.APIHandler=function(c,d){e="test"===c?new MockApi:new a.NetworkedAPI(d);this.getMatrixSize=function(){return e.getMatrixSize()};this.getRowHeadersFromTopRow=function(a){for(var c=
h.getCellElements().length,d=[],e=0;e<c;++e)d.push("row: "+(a+e));return d};this.getColHeadersFromLeftCol=function(a){for(var c=h.getCellElements()[0].length,d=[],e=0;e<c;++e)d.push("col: "+(a+e));return d};this.getRowDataForCell=function(c){var d=a.Constants.N_BACKGROUND_CELLS,g=[];if((c=e.getResponse({row1:c.row,col1:c.col-d,row2:c.row,col2:c.col-d+h.getCellElements()[0].length}))&&c.data&&1==c.data.length)for(d=0;d<c.data[0].length;++d)g.push(c.data[0][d]);return g};this.getColDataForCell=function(c){var d=
a.Constants.N_BACKGROUND_CELLS,g=[];if((c=e.getResponse({row1:c.row-d,col1:c.col,row2:c.row-d+h.getCellElements().length,col2:c.col}))&&c.data)for(d=0;d<c.data.length;++d)g.push(c.data[d][0]);return g};this.setRenderer=function(a){h=a};this.getResponse=function(a){return e.getResponse(a)};this.getResponseData=function(a){return e.getResponse(a).data};this.getResponseDataAsync=function(a,c){e.getResponseDataAsync(a,c)};var e,h;return this}})(jQuery,jMatrixBrowseNs);
